---
title: "Price predictors of used cars"
author: "Bilal Naseem, Franco Doi, Gautham Chandra Shekariah, Joao Bertti Targino, Romith Bondada"
date: "2025-03-30"
output:
  word_document
editor_options: 
  markdown: 
    wrap: sentence
header-includes:
  - \usepackage{graphicx}
  - \usepackage{float} 
  - \usepackage{listings}
  - \lstset{breaklines=true, xleftmargin=20pt, basicstyle=\tiny, frame=single}
---

"Built with R version `r getRversion()`"
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(ggplot2)
library(mosaic)
library(tidyverse)
library(webshot2)
library(latex2exp)
library(olsrr)


library(rmarkdown)
library(officer)

library(corrplot)
library(ggplot2)
library(gridExtra)
library(scales)
library(lubridate)
library(knitr)
library(reshape2)

```


## Winter 2025 DATA 603: Project


```{r}
# 1. Data Loading and Initial Exploration
# ---------------------------------------

zip_url <- "https://www.kaggle.com/api/v1/datasets/download/taeefnajib/used-car-price-prediction-dataset"
# Create a temporary file to download the ZIP
temp_file <- tempfile(fileext = ".zip")

# Download the file
download.file(zip_url, temp_file, mode = "wb")

# List files inside the ZIP
csv_file_name <- unzip(temp_file, list = TRUE)$Name[1]  # choose appropriate file if more than one

used_cars_data <- read.csv(unz(temp_file, csv_file_name))
```

```{r}
# remove string and convert string to number
used_cars_data$price <- gsub("[$,]", "", used_cars_data$price)
used_cars_data$price <- as.integer(used_cars_data$price)

# remove string and convert string to number
used_cars_data$milage <- gsub("[, mi]", "", used_cars_data$milage)
used_cars_data$milage <- as.integer(used_cars_data$milage)

#renaming column
names(used_cars_data)[names(used_cars_data) == "milage"] <- "mileage"
```


```{r}
# Display basic information about the dataset
str(used_cars_data)
```

```{r}
summary(used_cars_data)
```


```{r}
# Check for missing values
missing_values <- colSums(is.na(used_cars_data))
cat("\nMissing values per column:\n")
print(missing_values[missing_values > 0])
```
```{r}
# Check for duplicates
cat("\nNumber of duplicate rows:", sum(duplicated(used_cars_data)), "\n")

```

```{r}
categorical_vars <- c("brand", "model", "fuel_type", "engine", "transmission", "ext_col", "int_col", "accident", "clean_title")
used_cars_data[categorical_vars] <- lapply(used_cars_data[categorical_vars], as.factor)
```


```{r}
# 3.3.2. Univariate Analysis
# ---------------------

# 3.3.2.1 Price Distribution (Target Variable)
ggplot(used_cars_data, aes(x = price)) +
  geom_histogram(bins = 50, fill = "steelblue", alpha = 0.7) +
  scale_x_continuous(labels = scales::comma) +
  labs(title = "Distribution of Car Prices",
       x = "Price ($)",
       y = "Count") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5))

```

```{r}
# Log-transformed price for better visualization
ggplot(used_cars_data, aes(x = log(price))) +
  geom_histogram(bins = 50, fill = "steelblue", alpha = 0.7) +
  labs(title = "Distribution of Log-Transformed Car Prices",
       x = "Log(Price)",
       y = "Count") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5))
```


```{r}
# 3.3.2.2 Numerical Variables Analysis
numerical_vars <- c("model_year", "mileage")

# Function to create histograms for numerical variables using tidy evaluation
plot_histogram <- function(data, var_name) {
  ggplot(data, aes(x = .data[[var_name]])) +
    geom_histogram(bins = 30, fill = "cornflowerblue", alpha = 0.7) +
    labs(title = paste("Distribution of", var_name),
         x = var_name,
         y = "Count") +
    theme_minimal() +
    theme(plot.title = element_text(hjust = 0.5))
}

# Apply the function to each numerical variable
num_plots <- lapply(numerical_vars, function(var) {
  plot_histogram(used_cars_data, var)
})

# Display plots in a grid
grid.arrange(grobs = num_plots, ncol = 2)

```

